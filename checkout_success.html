<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pesanan Berhasil - UD Fikri</title>
<link rel="stylesheet" href="css/cart.css">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
<header class="topbar">
  <div class="logo">UD Fikri</div>
  <nav><a href="index.html">Beranda</a> · <a href="produk.html">Produk</a></nav>
</header>

<main class="checkout-success">
  <h2>✅ Pesanan Berhasil Dibuat</h2>
  <p>Terima kasih telah berbelanja di UD Fikri!</p>
  <div id="order-details">Memuat detail pesanan...</div>
  <button onclick="window.location.href='produk.html'">Belanja Lagi</button>
</main>

<script>
const SUPABASE_URL = "https://ucizdtqovtajqjkgoyef.supabase.co";
const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVjaXpkdHFvdnRhanFqa2dveWVmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA4MTU5NjAsImV4cCI6MjA3NjM5MTk2MH0.c4CfIOGV6HqSTT_GkCZTSxjYfv5YmCHOMuMpXreRX8I";
const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

function getOrderId() {
  const params = new URLSearchParams(window.location.search);
  return params.get('order');
}

async function loadOrder() {
  const orderId = getOrderId();
  if(!orderId) return document.getElementById('order-details').textContent = "Order ID tidak ditemukan";

  // Ambil data order
  const { data: order, error: orderErr } = await supabase.from('orders').select('*').eq('id', orderId).maybeSingle();
  if(orderErr || !order) return document.getElementById('order-details').textContent = "Gagal memuat order";

  // Ambil items
  const { data: items, error: itemsErr } = await supabase.from('order_items').select('*').eq('order_id', orderId);
  if(itemsErr) return document.getElementById('order-details').textContent = "Gagal memuat item order";

  let html = `<p><strong>Nomor Pesanan:</strong> ${order.id}</p>`;
  html += `<p><strong>Penerima:</strong> ${order.customer_name}</p>`;
  html += `<p><strong>Telepon:</strong> ${order.customer_phone}</p>`;
  html += `<p><strong>Alamat:</strong> ${order.shipping_address}, ${order.shipping_city}</p>`;
  html += `<h3>Produk:</h3><ul>`;
  items.forEach(i => {
    html += `<li>${i.product_name} x${i.qty} = Rp ${Number(i.subtotal).toLocaleString('id-ID')}</li>`;
  });
  html += `</ul>`;
  html += `<p><strong>Subtotal:</strong> Rp ${Number(order.subtotal).toLocaleString('id-ID')}</p>`;
  html += `<p><strong>Diskon:</strong> Rp ${Number(order.discount_amount).toLocaleString('id-ID')}</p>`;
  html += `<p><strong>Ongkir:</strong> Rp ${Number(order.shipping_cost).toLocaleString('id-ID')}</p>`;
  html += `<p><strong>Total:</strong> Rp ${Number(order.total).toLocaleString('id-ID')}</p>`;
  document.getElementById('order-details').innerHTML = html;
}

loadOrder();
</script>
</body>
</html>
